# Rubik's Cube Solver

An online Rubik's Cube solver built with React and Three.js, featuring 3D visualization, manual manipulation, and automatic solving capabilities.

## Features

- 🎲 **3D Visualization**: Realistic 3D Rubik's Cube rendering using Three.js
- 🎮 **Interactive Controls**: Mouse rotation, zoom, and manual face rotation
- 🔄 **Scramble Function**: Randomly scramble the cube
- 🤖 **Multiple Solving Algorithms**: Support for various solving algorithms
- 🎬 **Smooth Animations**: 3D rotation animations for all moves
- 📊 **Step-by-step Playback**: View solution steps and replay them step by step
- 🐛 **Debug Mode**: Toggle coordinate display for each face

## Architecture

### Design Overview

The application is built with a component-based architecture:

- **State Management**: React hooks (`useState`, `useRef`, `useEffect`) for managing cube state, animations, and solution steps
- **3D Rendering**: Three.js with React Three Fiber for efficient 3D rendering
- **Animation System**: Custom animation system that rotates cubies around face centers
- **Solver Integration**: Modular solver system supporting multiple algorithms

### Core Components

- **`App.tsx`**: Main application component managing global state and event handlers
- **`RubiksCube.tsx`**: 3D cube rendering component with animation support
- **`Cubie.tsx`**: Individual cubie component with color and coordinate display
- **`ControlPanel.tsx`**: UI controls for scrambling, solving, and manual moves

### Core Utilities

- **`cubeTypes.ts`**: TypeScript type definitions for cube state, moves, and colors
- **`cubeLogic.ts`**: Core cube rotation logic and state manipulation
- **`cubeAnimation.ts`**: Animation system for smooth 3D rotations
- **`cubeSolver.ts`**: Solver dispatcher supporting multiple algorithms
- **`cubeConverter.ts`**: Conversion between internal state and external formats (cubestring)
- **`thistlethwaite.ts`**: Thistlethwaite four-stage algorithm implementation

## Supported Algorithms

The application supports multiple solving algorithms, selectable via the UI:

### 1. Reverse Moves (Default)
- **Speed**: ⚡⚡⚡⚡⚡ (Fastest)
- **Requirements**: Requires scramble sequence history
- **Description**: Simply reverses the scramble sequence. Perfect for states generated by the scramble function.
- **Use Case**: Best for testing and when scramble history is available

### 2. Kociemba Algorithm
- **Speed**: ⚡⚡⚡⚡ (Fast)
- **Requirements**: Valid cubestring format
- **Description**: Two-phase algorithm using the `cube-solver` library. Provides near-optimal solutions.
- **Use Case**: General-purpose solving when scramble history is not available
- **Note**: Currently has issues with cubestring format conversion accuracy

### 3. IDA* (Iterative Deepening A*)
- **Speed**: ⚡⚡ (Slow)
- **Requirements**: None
- **Description**: Optimal search algorithm that finds the shortest solution path. Uses a simple heuristic function.
- **Use Case**: When optimal solutions are required, but may be slow for complex states
- **Limitations**: Can be very slow for states requiring many moves

### 4. Thistlethwaite Algorithm
- **Speed**: ⚡ (Very Slow)
- **Requirements**: None
- **Description**: Four-stage algorithm that progressively restricts the cube to subgroups. Implemented with asynchronous BFS search.
- **Use Case**: Educational purposes, understanding group theory approach
- **Limitations**: 
  - Very slow for complex states
  - May timeout on stage 2->3 transition
  - Simplified implementation (not full group theory)

## Current Issues

### Known Problems

1. **Kociemba Cubestring Format**
   - **Issue**: The conversion from internal `CubeState` to Kociemba's `cubestring` format may be incorrect
   - **Impact**: Solutions from Kociemba algorithm may not correctly solve the cube
   - **Status**: Under investigation
   - **Workaround**: Use "Reverse Moves" algorithm when scramble history is available

2. **Thistlethwaite Performance**
   - **Issue**: The algorithm is very slow and may timeout on stage 2->3 transition
   - **Impact**: Complex states may fail to solve within timeout period
   - **Status**: Simplified implementation, may need optimization or full group theory implementation
   - **Workaround**: Use other algorithms for practical solving

3. **Animation Reset**
   - **Issue**: After animation completes, cubies are reset to their original positions before the new state is applied
   - **Impact**: Brief visual glitch during state transition
   - **Status**: Minor issue, does not affect functionality

### Future Improvements

- Fix Kociemba cubestring conversion accuracy
- Optimize Thistlethwaite algorithm or implement full group theory version
- Add solution step auto-playback with configurable speed
- Add move notation display (e.g., "R U R' U'")
- Improve animation smoothness and add easing functions
- Add cube state import/export functionality
- Support for different cube sizes (2x2, 4x4, etc.)

## Technology Stack

- **React 18** - UI framework
- **Three.js** - 3D graphics rendering
- **@react-three/fiber** - React Three.js renderer
- **@react-three/drei** - Three.js utilities
- **cube-solver** - Kociemba algorithm library
- **TypeScript** - Type safety
- **Vite** - Build tool and dev server

## Installation and Usage

### Prerequisites

- Node.js 16+ and npm

### Installation

1. Install dependencies:
```bash
npm install
```

2. Start development server:
```bash
npm run dev
```

3. Build for production:
```bash
npm run build
```

### Usage

1. **Rotate View**: Left mouse button drag
2. **Zoom**: Mouse wheel
3. **Scramble**: Click "Scramble" button
4. **Manual Moves**: Click rotation buttons in control panel (R, R', L, L', etc.)
5. **Solve**: 
   - Select an algorithm from the dropdown
   - Click "Solve" button
   - Use "Previous Step"/"Next Step" buttons to navigate through solution
6. **Debug Mode**: Toggle coordinate display for each face using the checkboxes

## Project Structure

```
src/
  ├── components/              # React components
  │   ├── RubiksCube.tsx      # 3D cube rendering component
  │   ├── Cubie.tsx           # Individual cubie component
  │   └── ControlPanel.tsx    # Control panel UI
  ├── utils/                  # Utility functions
  │   ├── cubeTypes.ts        # TypeScript type definitions
  │   ├── cubeLogic.ts        # Cube rotation logic
  │   ├── cubeAnimation.ts    # Animation system
  │   ├── cubeSolver.ts       # Solver dispatcher
  │   ├── cubeConverter.ts    # State format conversion
  │   └── thistlethwaite.ts    # Thistlethwaite algorithm
  ├── App.tsx                 # Main application component
  └── main.tsx                # Entry point
```

## License

MIT

---

# 魔方还原程序

一个基于 React + Three.js 的在线魔方还原程序，支持3D可视化、手动操作和自动求解功能。

## 功能特性

- 🎲 **3D可视化**：使用 Three.js 渲染逼真的3D魔方
- 🎮 **交互操作**：支持鼠标旋转视角、缩放，以及手动旋转魔方面
- 🔄 **打乱功能**：随机打乱魔方
- 🤖 **多种求解算法**：支持多种求解算法
- 🎬 **平滑动画**：所有移动都有3D旋转动画
- 📊 **步骤回放**：查看求解步骤并逐步回放
- 🐛 **调试模式**：可以切换显示每个面的坐标

## 架构设计

### 设计概览

应用程序采用基于组件的架构：

- **状态管理**：使用 React hooks (`useState`, `useRef`, `useEffect`) 管理魔方状态、动画和求解步骤
- **3D渲染**：使用 Three.js 和 React Three Fiber 进行高效的3D渲染
- **动画系统**：自定义动画系统，围绕面的中心旋转小块
- **求解器集成**：模块化求解器系统，支持多种算法

### 核心组件

- **`App.tsx`**：主应用组件，管理全局状态和事件处理
- **`RubiksCube.tsx`**：3D魔方渲染组件，支持动画
- **`Cubie.tsx`**：单个小块组件，支持颜色和坐标显示
- **`ControlPanel.tsx`**：打乱、求解和手动操作的UI控制面板

### 核心工具

- **`cubeTypes.ts`**：魔方状态、移动和颜色的 TypeScript 类型定义
- **`cubeLogic.ts`**：核心魔方旋转逻辑和状态操作
- **`cubeAnimation.ts`**：平滑3D旋转的动画系统
- **`cubeSolver.ts`**：支持多种算法的求解器调度器
- **`cubeConverter.ts`**：内部状态和外部格式（cubestring）之间的转换
- **`thistlethwaite.ts`**：Thistlethwaite 四阶段算法实现

## 支持的算法

应用程序支持多种求解算法，可通过UI选择：

### 1. 反向移动（默认）
- **速度**：⚡⚡⚡⚡⚡（最快）
- **要求**：需要打乱序列历史
- **描述**：简单地反转打乱序列。非常适合由打乱功能生成的状态。
- **使用场景**：测试和当有打乱历史时最佳

### 2. Kociemba 算法
- **速度**：⚡⚡⚡⚡（快速）
- **要求**：有效的 cubestring 格式
- **描述**：使用 `cube-solver` 库的两阶段算法。提供接近最优的解。
- **使用场景**：当没有打乱历史时的一般用途求解
- **注意**：当前 cubestring 格式转换准确性存在问题

### 3. IDA*（迭代加深A*）
- **速度**：⚡⚡（较慢）
- **要求**：无
- **描述**：最优搜索算法，找到最短解路径。使用简单的启发式函数。
- **使用场景**：需要最优解时，但对于复杂状态可能很慢
- **限制**：对于需要很多步的状态可能非常慢

### 4. Thistlethwaite 算法
- **速度**：⚡（非常慢）
- **要求**：无
- **描述**：四阶段算法，逐步将魔方限制到子群。使用异步BFS搜索实现。
- **使用场景**：教育目的，理解群论方法
- **限制**：
  - 对于复杂状态非常慢
  - 可能在阶段 2->3 转换时超时
  - 简化实现（非完整群论）

## 当前问题

### 已知问题

1. **Kociemba Cubestring 格式**
   - **问题**：从内部 `CubeState` 到 Kociemba 的 `cubestring` 格式的转换可能不正确
   - **影响**：Kociemba 算法的解可能无法正确还原魔方
   - **状态**：正在调查中
   - **解决方法**：当有打乱历史时使用"反向移动"算法

2. **Thistlethwaite 性能**
   - **问题**：算法非常慢，可能在阶段 2->3 转换时超时
   - **影响**：复杂状态可能在超时期间内无法求解
   - **状态**：简化实现，可能需要优化或完整群论实现
   - **解决方法**：实际求解时使用其他算法

3. **动画重置**
   - **问题**：动画完成后，小块在应用新状态之前会重置到原始位置
   - **影响**：状态转换期间的短暂视觉故障
   - **状态**：小问题，不影响功能

### 未来改进

- 修复 Kociemba cubestring 转换准确性
- 优化 Thistlethwaite 算法或实现完整群论版本
- 添加可配置速度的求解步骤自动回放
- 添加移动符号显示（例如 "R U R' U'"）
- 改善动画平滑度并添加缓动函数
- 添加魔方状态导入/导出功能
- 支持不同大小的魔方（2x2、4x4等）

## 技术栈

- **React 18** - UI框架
- **Three.js** - 3D图形渲染
- **@react-three/fiber** - React Three.js 渲染器
- **@react-three/drei** - Three.js 工具库
- **cube-solver** - Kociemba 算法库
- **TypeScript** - 类型安全
- **Vite** - 构建工具和开发服务器

## 安装和使用

### 前置要求

- Node.js 16+ 和 npm

### 安装

1. 安装依赖：
```bash
npm install
```

2. 启动开发服务器：
```bash
npm run dev
```

3. 构建生产版本：
```bash
npm run build
```

### 使用方法

1. **旋转视角**：鼠标左键拖拽
2. **缩放**：鼠标滚轮
3. **打乱魔方**：点击"打乱"按钮
4. **手动操作**：点击控制面板中的旋转按钮（R, R', L, L'等）
5. **自动求解**：
   - 从下拉菜单中选择算法
   - 点击"求解"按钮
   - 使用"上一步"/"下一步"按钮逐步查看求解过程
6. **调试模式**：使用复选框切换显示每个面的坐标

## 项目结构

```
src/
  ├── components/              # React组件
  │   ├── RubiksCube.tsx      # 3D魔方渲染组件
  │   ├── Cubie.tsx           # 单个小块组件
  │   └── ControlPanel.tsx    # 控制面板UI
  ├── utils/                  # 工具函数
  │   ├── cubeTypes.ts        # TypeScript类型定义
  │   ├── cubeLogic.ts        # 魔方旋转逻辑
  │   ├── cubeAnimation.ts    # 动画系统
  │   ├── cubeSolver.ts       # 求解器调度器
  │   ├── cubeConverter.ts    # 状态格式转换
  │   └── thistlethwaite.ts   # Thistlethwaite算法
  ├── App.tsx                 # 主应用组件
  └── main.tsx                # 入口文件
```

## 许可证

MIT
